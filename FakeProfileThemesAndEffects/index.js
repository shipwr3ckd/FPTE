((e,t,r,o,n,i,l,a,s,c,f,d)=>{"use strict";var u=e.FluxDispatcher,m=t.findByStoreName("CollectiblesPurchaseStore"),p=t.findByStoreName("ProfileEffectStore"),h=t.findByStoreName("UserProfileStore"),E=t.findByStoreName("UserStore"),y=n.semanticColors,g=t.find((e=>e.default?.internal?.resolveSemanticColor))?.default.internal.resolveSemanticColor??t.find((e=>e.meta?.resolveSemanticColor))?.meta.resolveSemanticColor??(()=>{}),v=t.findByProps("useAvatarColors")?.useAvatarColors??(()=>{}),P=t.findByProps("getProfileTheme").getProfileTheme,S=t.findByProps("useThemeContext")?.useThemeContext??(()=>({})),C=t.findByProps("ThemeContextProvider")?.ThemeContextProvider??(e=>{var{children:t}=e;return t});function b(){u.dispatch({type:"USER_SETTINGS_ACCOUNT_SUBMIT_SUCCESS"})}var A=!0,B=null;function T(e){var[t,r]=o.useState((()=>B=e));return[t,e=>{r(B=e),A&&b()}]}var F,I=null;function N(e){var[t,r]=o.useState((()=>I=e));return[t,e=>{r(I=e),A&&b()}]}function w(e){F=e}var _=(()=>{var e=t.findByName("useProfileTheme",!1);return e?()=>r.after("default",e,((e,t)=>{var[r]=e,{user:o}=r;return(null!=o&&o.id===F||"pendingThemeColors"in r)&&A&&(null!==B?(t.theme=P(B),t.primaryColor=B,t.secondaryColor=I??B):null!==I&&(t.theme=P(I),t.primaryColor=I,t.secondaryColor=I)),t})):(e=t.findByName("useProfileThemeColors",!1))?()=>r.after("default",e,((e,t)=>{var[r,o,n]=e;if((null!=r&&r.id===F||n)&&A){if(null!==B)return[B,I??B];if(null!==I)return[I,I]}return t})):()=>()=>!0})(),R=8203,x=String.fromCodePoint(R),U=4096,D=917504,L=D+U-1;function z(e,t){return String.fromCodePoint(...[..."[#".concat(e.toString(16),",#").concat(t.toString(16),"]")].map((e=>e.codePointAt(0)+D)))}function O(e){var[t,r]=e.matchAll(/(?<=#)[\dA-Fa-f]{1,6}/g);return[t?parseInt(t[0],16):-1,r?parseInt(r[0],16):-1]}function k(e){if(0===e)return String.fromCodePoint(D);for(var t="";e>0;e=Math.trunc(e/U))t=String.fromCodePoint(e%U+D)+t;return t}function H(e){if(""===e)return-1;for(var t=0,r=0;r<e.length;r++){if(t>16777215)return-2;t+=e.codePointAt(r)*U**(e.length-1-r)}return t}function V(e){if(0n===e)return String.fromCodePoint(D);for(var t="";e>0n;e/=BigInt(U))t=String.fromCodePoint(Number(e%BigInt(U))+D)+t;return t}function M(e){if(""===e)return-1n;for(var t=0n,r=0;r<e.length;r++){if(t>=10000000000000000000n)return-2n;t+=BigInt(e.codePointAt(r))*BigInt(U)**BigInt(e.length-1-r)}return t}function G(e){var t=["","",""],r=0;for(var o of e){var n=o.codePointAt(0);if(n===R){if(r>=2)break;r++}else if(D>n||n>L){if(r>0||t[0])break}else t[r]+=String.fromCodePoint(n-D)}return t}function X(e){for(var t of e){var r=t.codePointAt(0);if(r>=D&&L>=r||r===R)return!0}return!1}function j(e){return[...e].filter((e=>{var t=e.codePointAt(0);return(D>t||t>L)&&t!==R})).join("").trim()}function W(e,t,r){t>-1?(e.themeColors=[t,r>-1?r:t],e.premiumType=2):r>-1&&(e.themeColors=[r,r],e.premiumType=2)}function K(e,t){t>-1n&&(e.profileEffectId=e.profileEffectID=t.toString(),e.premiumType=2)}var Y,Z=t.findByName("ProfileEffectRecord");(e=>{e[e.AVATAR_DECORATION=0]="AVATAR_DECORATION",e[e.PROFILE_EFFECT=1]="PROFILE_EFFECT",e[e.NONE=100]="NONE",e[e.BUNDLE=1e3]="BUNDLE"})(Y||(Y={}));var q,J=t.findByPropsAll("NONE_ITEM");function Q(e){return"function"==typeof e[Symbol.iterator]}function $(e){return null!==e&&"object"==typeof e}function ee(e){return $(e)&&"type"in e}function te(e){return"children"in e.props}function re(e){return"symbol"==typeof e?Symbol.keyFor(e)||null:"function"==typeof e?e.displayName||e.name||null:"_context"in e?e._context.displayName||null:e.displayName?e.displayName:"render"in e?e.render.displayName||e.render.name||null:"type"in e?re(e.type):null}function oe(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:200;if($(e))if(Q(e)){if(r>0)for(var o of e){var n=oe(o,t,r-1);if(n)return n}}else{if(t(e))return e;if(te(e))return oe(e.props.children,t,r-1)}return null}function ne(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:200;if($(e))if(Q(e)){if(r>0)for(var o of e){var n=ne(o,t,r-1);if(n)return n}}else if(te(e))return t(e.props.children)?e:ne(e.props.children,t,r-1);return null}var ie,le=t.findByName("EditProfileEffectActionSheet"),ae=le?e=>{var{currentEffectId:t,effects:r,onSelect:n,user:l}=e,a=le({user:l}),s=S(),c=o.useMemo((()=>r.map((e=>({items:new Z(e)})))),[r]);if(i.storage.forceFallbackEffectPicker)return o.createElement(Pe,e);var f=!1,d=oe(a,(e=>"EditProfileEffectInner"===re(e.type)||"profileEffects"in e.props&&"selectedProfileEffect"in e.props&&"function"==typeof e.props.setSelectedProfileEffect&&(f=!0)));if(!d)return ie||o.createElement(Pe,e);var u=oe(a,(e=>"Button"===re(e.type)));if(!u)return ie||o.createElement(Pe,e);if(f){void 0===d.props.selectedProfileEffect&&d.props.setSelectedProfileEffect(e.currentEffectId?{id:e.currentEffectId}:null),d.props.profileEffects=e.effects;var m=ne(a,(e=>Array.isArray(e)&&e.some((e=>"DisplayBanner"===re(e.type)))));if(m){var p=a;m.props.children=o.createElement(C,{theme:p.props.theme,primaryColor:p.props.primaryColor,secondaryColor:p.props.secondaryColor,children:m.props.children}),p.props.theme=s.theme,p.props.primaryColor=s.primaryColor,p.props.secondaryColor=s.secondaryColor}}else void 0===d.props.selectedProfileEffect&&d.props.setSelectedProfileEffect(t?new Z({id:t}):null),d.props.purchases=c;return w(l.id),u.props.onPress=()=>{w(void 0),n(r.find((e=>e.id===d.props.selectedProfileEffect?.id))?.config??null)},ie=a}:Pe,se=t.findByProps("triggerHapticFeedback"),ce=se?.HapticFeedbackTypes??{},fe=se?.triggerHapticFeedback??(()=>{}),de=c.getAssetIDByName("img_none"),ue=t.findByProps("DEFAULT_PROFILE_EFFECT_WH_RATIO")?.DEFAULT_PROFILE_EFFECT_WH_RATIO??45/88,me=c.getAssetIDByName("sample-profile-small")??{uri:"https://discordapp.com/assets/f328a6f8209d4f1f5022.png"};c.getAssetIDByName("toast_copy_link"),c.getAssetIDByName("Small");var pe=t.findByProps("Radius")?.Radius??{},he=t.findByProps("Spacing")?.Spacing??{},Ee=t.findByProps("SafeAreaContext")?.SafeAreaContext,ye=t.findByName("useWindowDimensions")??(()=>{}),ge=3;function ve(e){var{label:t,isSelected:r,size:n,colors:i,onPress:l,style:a,children:s}=e,[c,f,d]=i;return o.createElement(je,{accessibilityLabel:t,accessibilityRole:"button",accessibilityState:{selected:r},disabled:r,onPress(){fe(ce.IMPACT_LIGHT),l()},style:[{height:n,width:n,overflow:"hidden",backgroundColor:f,borderColor:c,borderRadius:pe.sm,borderWidth:2},r&&{borderColor:d},a]},s)}function Pe(e){var{currentEffectId:t,effects:r,onSelect:n}=e,[i,l]=o.useState(t),[c,f]=o.useState(0),{theme:d}=S(),u=o.useMemo((()=>[g(d,y.BACKGROUND_PRIMARY),g(d,y.BACKGROUND_FLOATING),g(d,y.BUTTON_OUTLINE_BRAND_BORDER_ACTIVE)]),[d]),m=ye(),p=o.useContext(Ee),h=o.useMemo((()=>{for(var e=s.chunk([null,...r],ge),t=e[e.length-1];3>t.length;)t.push(void 0);return e}),[r]);return o.createElement(Ae,{transparentHeader:!0,scrollable:!0,startExpanded:!0,startHeight:m.height-p.top},o.createElement(Be,{scrollsToTop:!1},o.createElement(a.View,{style:{flex:1,flexDirection:"column",alignItems:"center",paddingBottom:88}},o.createElement(He,{variant:"redesign/heading-18/bold",color:"header-primary",style:{margin:he.PX_16}},t?"Change Effect":"Add Profile Effect"),o.createElement(a.View,{style:{width:"72%",minHeight:38}},o.createElement(He,{variant:"heading-md/bold",color:"header-primary",style:{textAlign:"center"}},r.find((e=>e.id===i))?.config.title??"None")),o.createElement(a.View,{style:{flex:1,width:"92%",marginTop:3}},o.createElement(Ve,{accessibilityLabel:"Profile Effect Selection Section",numColumns:1,estimatedItemSize:98,ItemSeparatorComponent:()=>o.createElement(a.View,{style:{height:he.PX_16}}),contentContainerStyle:{paddingHorizontal:he.PX_4},data:h,extraData:i,renderItem(e){var{item:t}=e;return o.createElement(a.View,{style:{flexDirection:"row",alignItems:"center",justifyContent:"space-between",paddingHorizontal:he.PX_16}},t.map((e=>e?o.createElement(ve,{label:e.config.accessibilityLabel,isSelected:e.id===i,size:c,colors:u,onPress(){l(e.id)}},o.createElement(ke,{effect:e.config})):null===e?o.createElement(ve,{label:"None",isSelected:!i,size:c,colors:u,onPress(){l(void 0)},style:{alignItems:"center",justifyContent:"center"}},o.createElement(Oe,{source:de,size:Oe.Sizes.LARGE}),o.createElement(He,{variant:"text-sm/medium",color:"header-primary",style:{marginTop:he.PX_4}},"None")):o.createElement(a.View,{style:{width:c,height:c}}))))},onLayout(e){f((e.nativeEvent.layout.width-64)/ge)}})))),o.createElement(ze,{text:"Apply",textStyle:{fontSize:16},onPress(){n(r.find((e=>e.id===i))?.config??null)},style:{position:"absolute",right:0,bottom:0,left:0,height:48,marginHorizontal:36,marginBottom:he.PX_48,borderRadius:pe.round}}))}var Se=t.findByName("showCustomColorPickerActionSheet")??(()=>{});function Ce(e){var t;return(t=e).color??(t.color=0),Se(e)}var be="__FPTE__",Ae=t.findByProps("BottomSheet")?.BottomSheet??t.findByProps("ActionSheet")?.ActionSheet??(()=>{throw Error("FakeProfileThemesAndEffects threw an error to avoid an otherwise-inevitable, unrecoverable freeze.")}),Be=t.findByProps("BottomSheetScrollView")?.BottomSheetScrollView??(()=>null),Te=t.findByProps("showActionSheet"),Fe=Te?.showActionSheet??(()=>{}),Ie=Te?.default?.hideActionSheet??(()=>{}),Ne=f.Forms.FormSection,we=f.Forms.FormRow,_e=f.Forms.FormRadioRow,Re=f.Forms.FormSwitchRow,xe=f.Forms.FormCardSection,Ue=t.findByProps("saveProfileChanges");function De(e){var{guildId:t}=e,[r,n]=T(null),[i,s]=N(null),[c,f]=o.useState(null);(e=>{var[t,r]=o.useState((()=>A=!0))})();var[d,m]=o.useState(!1),{theme:P}=S(),[C,b]=o.useMemo((()=>[g(P,y.HEADER_SECONDARY),g(P,y.BACKGROUND_ACCENT)]),[P]),B=v(E.getCurrentUser().getAvatarURL(t,80),b,!1),[F,I]=o.useState(null);o.useEffect((()=>{var e=E.getCurrentUser();if(e){var t=h.getUserProfile(e.id);t&&I(t.bio??null)}}),[]);var _=null!==F&&X(F),R=null!==r||null!==i||null!==c,U=((e,t,r,o)=>{var n="";if(o){if(e>=0)return n=z(e,0>t?e:t),r&&(n+=x+V(BigInt(r))),n;if(t>=0)return n=z(t,t),r&&(n+=x+V(BigInt(r))),n}else if(0>e)0>t||(n=k(t));else if(n=k(e),t>=0&&e!==t)return n+=x+k(t),r&&(n+=x+V(BigInt(r))),n;return r&&(n+=x+x+V(BigInt(r))),n})(r??-1,i??-1,c?.id??"",d),D=_&&!R?"Remove FPTE":"Apply FPTE",L=R||_;return o.createElement(xe,{title:o.createElement(a.View,{style:{flexDirection:"row",alignItems:"center"}},o.createElement(a.Text,{style:{fontSize:16,color:"#FFFFFF"}},"FPTE Builder"),o.createElement(a.Text,{style:{color:_?"#4CAF50":"#F44336",fontSize:17,marginLeft:8}},_?"Active":"Inactive")),cardStyle:{backgroundColor:"transparent"}},o.createElement(a.View,{style:{flexDirection:"row",justifyContent:"space-between"}},o.createElement(Le,{fgColor:C,label:"Primary",bgColor:r,onPress:()=>Ce({color:r,onSelect:n,suggestedColors:B})}),o.createElement(Le,{fgColor:C,label:"Accent",bgColor:i,onPress:()=>Ce({color:i,onSelect:s,suggestedColors:B})}),o.createElement(Le,{fgColor:C,label:"Effect",onPress(){return e=f,t=c?.id,u.subscribe("HIDE_ACTION_SHEET",(function e(t){t.key===be&&(u.unsubscribe("HIDE_ACTION_SHEET",e),w(void 0))})),void Fe({content:o.createElement(ae,{effects:p.profileEffects,onSelect(t){e(t),Ie(be)},user:E.getCurrentUser(),currentEffectId:t}),key:be});var e,t}},c&&o.createElement(ke,{effect:c,style:{width:"140%",height:"100%"}})),o.createElement(a.View,{style:{flexDirection:"column",alignItems:"center",marginLeft:12}},o.createElement(ze,{text:D,size:ze.Sizes.SMALL,onPress(){var e=E.getCurrentUser();if(e){var t=F??"";if(!_||R){if(U){X(t)&&(t=j(t)),t.length>0&&(t+=" "),t+=U;try{Ue.saveProfileChanges({...h.getUserProfile(e.id),bio:t}),I(t),l.showToast("FPTE applied!")}catch(e){l.showToast("Failed to update bio!"),console.error(e)}}}else{t=j(t);try{Ue.saveProfileChanges({...h.getUserProfile(e.id),bio:t}),I(t),l.showToast("FPTE removed!")}catch(e){l.showToast("Failed to update bio!"),console.error(e)}}}},style:{marginBottom:6,paddingHorizontal:12,opacity:L?1:0},pointerEvents:L?"auto":"none"}),o.createElement(ze,{text:"Reset",look:ze.Looks.LINK,color:ze.Colors.TRANSPARENT,size:ze.Sizes.SMALL,...R?{}:{pointerEvents:"none",style:{opacity:0}},onPress(){n(null),s(null),f(null)}}))))}var Le=e=>{var{label:t,fgColor:r,bgColor:n,onPress:i,children:l}=e;return o.createElement(a.View,{style:{width:50}},o.createElement(je,{accessibilityLabel:t,accessibilityRole:"button",onPress:i,style:[{display:"flex",alignItems:"center",justifyContent:"center",height:50,overflow:"hidden",borderColor:r,borderStyle:"dashed",borderWidth:2,borderRadius:pe.xs},null!=n&&{backgroundColor:"#"+n.toString(16).padStart(6,"0"),borderStyle:"solid"},!!l&&{borderWidth:0}]},l??(null==n&&o.createElement(Ge,{fill:r,width:"40%",height:"40%",viewBox:"0 0 144 144"},o.createElement(Xe,{d:"M144 64H80V0H64v64H0v16h64v64h16V80h64Z"})))),!!t&&o.createElement(He,{variant:"text-sm/normal",style:{marginTop:he.PX_4,textAlign:"center"}},t))},ze=f.Button,Oe=t.findByProps("IconSizes")?.default??(()=>null),ke=e=>{var{effect:t,style:r}=e;return o.createElement(a.View,{style:r},o.createElement(a.Image,{resizeMode:"cover",source:me,style:{width:"100%",height:"100%"}}),o.createElement(a.Image,{alt:t.accessibilityLabel,resizeMethod:"resize",resizeMode:"cover",source:{uri:t.thumbnailPreviewSrc},style:{position:"absolute",width:"100%",aspectRatio:ue}}))},He=t.findByProps("TextStyleSheet")?.Text??(()=>null),Ve=t.findByName("FlashList")??(()=>null),Me=t.findByProps("Svg"),Ge=Me?.Svg??(()=>null),Xe=Me?.Path??(()=>null),je=t.findByProps("PressableOpacity")?.PressableOpacity??(()=>null),We=t.findByName("UserProfileEditForm",!1),Ke=t.findByName("UserProfileEditForm",!1);function Ye(e){if(!e)return null;if(ee(e)&&"UserProfilePremiumUpsellCard"===re(e.type))return null;if(e.props?.children){var t=e.props.children;Array.isArray(t)||(t=[t]);var r=t.map(Ye).filter((e=>null!==e));e.props.children=1===r.length?r[0]:r}return e}function Ze(){var e=E.getCurrentUser();if(e){var t=h.getUserProfile(e.id);t&&u.dispatch({type:"USER_PROFILE_FETCH_SUCCESS",user:e,user_profile:t,connected_accounts:t.connectedAccounts})}}var qe=[],Je={onLoad(){qe.push(r.instead("getPurchase",m,((e,t)=>F?{purchasedAt:new Date}:t(e))),r.after("getUserProfile",h,((e,t)=>{if(!t||t.profileFetchFailed)return t;if(i.storage.prioritizeNitro){if(t.themeColors){if(!t.profileEffectId&&!t.profileEffectID){var r=G(t.bio);-2===H(r[0])?K(t,M(r[1])):K(t,M(r[2]))}return t}if(t.profileEffectId||t.profileEffectID){var o=G(t.bio),n=H(o[0]);return-2===n?W(t,...O(o[0])):W(t,n,H(o[1])),t}}var l=G(t.bio),a=H(l[0]);return-2===a?(W(t,...O(l[0])),K(t,M(l[1]))):(W(t,a,H(l[1])),K(t,M(l[2]))),t})),...J.map((e=>r.after("default",e,((e,t)=>(F&&(void 0!==p.profileEffects?(t.splice(1),t[0].items.splice(1),p.profileEffects.forEach((e=>{t[0].items.push(new Z(e))})),q=t):t=q),t))))),_(),r.after("default",We,((e,t)=>{if(i.storage.hideBuilder)return t;var r=ne(t,(e=>Array.isArray(e)&&e.some((e=>ee(e)&&"UserProfileEditFormTextField"===re(e.type)))));if(r){var n=r.props.children.reduce(((e,t,r)=>(ee(t)&&"UserProfileEditFormTextField"===re(t.type)&&e.push(r),e)),[]);3>n.length||r.props.children.splice(n[2]+1,0,o.createElement(De,null))}return t})),void(Ke&&r.after("default",Ke,((e,t)=>Ye(t)||t)))),Ze()},onUnload(){qe.forEach((e=>{e()})),Ze()},settings:()=>(d.useProxy(i.storage),o.createElement(a.ScrollView,null,o.createElement(Ne,{title:"Settings"},o.createElement(we,{label:"Source to prioritize"}),o.createElement(_e,{label:"Nitro",selected:!!i.storage.prioritizeNitro,onPress(){i.storage.prioritizeNitro=!0}}),o.createElement(_e,{label:"About Me",selected:!i.storage.prioritizeNitro,onPress(){i.storage.prioritizeNitro=!1}}),o.createElement(Re,{label:"Hide Builder",subLabel:"Hide the FPTE Builder in the User Profile and Server Profiles settings pages",value:!!i.storage.hideBuilder,onValueChange(e){i.storage.hideBuilder=e}}),o.createElement(Re,{label:"Force fallback effect picker",value:!!i.storage.forceFallbackEffectPicker,onValueChange(e){i.storage.forceFallbackEffectPicker=e}}))))};return Je})(vendetta.metro.common,vendetta.metro,vendetta.patcher,React,vendetta.ui,vendetta.plugin,vendetta.ui.toasts,vendetta.metro.common.ReactNative,vendetta.metro.common.lodash,vendetta.ui.assets,vendetta.ui.components,vendetta.storage);
